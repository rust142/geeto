name: AI Issue Assessment

on:
  issues:
    types: [labeled]

jobs:
  ai-assessment:
    if: ${{ github.event.label.name == 'review' }}
    runs-on: ubuntu-latest
    permissions:
      issues: write
      models: read
      contents: read

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Run AI assessment
        id: ai-assessment
        uses: github/ai-assessment-comment-labeler@v1.0.1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          ai_review_label: 'copilot'
          issue_number: ${{ github.event.issue.number }}
          issue_body: ${{ github.event.issue.body }}
          repo_name: ${{ github.event.repository.name }}
          prompts_directory: './prompts'
          labels_to_prompts_mapping: 'copilot,issue-review.prompt.yml|bug,issue-review.prompt.yml|feature,issue-review.prompt.yml|docs,issue-review.prompt.yml|help,issue-review.prompt.yml|howto,issue-review.prompt.yml|usage,issue-review.prompt.yml|tool,issue-review.prompt.yml|expert,issue-review.prompt.yml|question,issue-review.prompt.yml'

      - name: Debug summary (optional)
        if: always()
        run: |
          echo "AI assessments output: ${{ steps.ai-assessment.outputs.ai_assessments }}"
